<!DOCTYPE html>
<html>
<head>
    <title>{{ question.content }}</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='qna_styles.css') }}">
</head>
<body>
    <div class="banner">
        <div class="navbar">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="MMU University Student Hub & Tutorial Website" class="banner-img">

            <ul>
                <li>
                    <a href="http://127.0.0.1:5000/register">
                        <img src="{{ url_for('static', filename='signup.png') }}" alt="Sign Up" class="nav-img">
                    </a>
                </li>
                <li>
                    <a href="http://127.0.0.1:5000/logout">
                        <img src="{{ url_for('static', filename='logout.png') }}" alt="Logout" class="nav-img">
                    </a>
                </li>
            </ul>
        </div>

        
        <div class="question">
            <h3>{{ question.content }}</h3>
            <p>Posted by: <strong>{{ question.user.username }}</strong></p>
        </div>
        
        <div class="answer-form">
            <h2>Submit Your Answer</h2>
            <form action="{{ url_for('view_question', question_id=question.id) }}" method="POST">
                <textarea name="answer" placeholder="Type your answer here..." required></textarea>
                <button type="submit" class="button">Submit Answer</button>
            </form>
        </div>

        <div class="answers">
            <h2>Answers</h2>
            {% for answer in answers.items %}
            <div class="answer">
                <p>{{ answer.content }}</p>

                <div class="button-container">
                    <form action="{{ url_for('upvote_answer', answer_id=answer.id) }}" method="POST" style="display: inline;">
                        <button type="submit" class="upvote-btn">Upvote</button>
                    </form>
                    <span>{{ answer.upvotes }} Upvotes</span>

                    <form action="{{ url_for('delete_answer', answer_id=answer.id) }}" method="POST" style="display: inline;">
                        <button type="submit" class="delete-btn">Delete</button>
                    </form>

                    <button class="edit-btn" onclick="toggleEditForm({{ answer.id }})">Edit</button>
                </div>

                <div id="edit-form-{{ answer.id }}" class="edit-form" style="display: none;">
                    <form action="{{ url_for('edit_answer', answer_id=answer.id) }}" method="POST">
                        <textarea name="answer" required>{{ answer.content }}</textarea>
                        <button type="submit" class="button">Update Answer</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>

        
        <div class="pagination">
            {% if answers.has_prev %}
                <a href="{{ url_for('view_question', question_id=question.id, page=answers.prev_num) }}">Previous</a>
            {% endif %}
            
            <span>Page {{ answers.page }} of {{ answers.pages }}</span>

            {% if answers.has_next %}
                <a href="{{ url_for('view_question', question_id=question.id, page=answers.next_num) }}">Next</a>
            {% endif %}
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <ul>
            {% for category, message in messages %}
            {% if category == 'upvote' %}
            <li style="color:rgb(0, 255, 136); font-weight:bold">{{ message }}</li>
            {% endif %}
            {% endfor %}
        </ul>
        {% endif %}
        {% endwith %}

        <script>
        function toggleEditForm(answerId) {
            const form = document.getElementById('edit-form-' + answerId);
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        }
        </script>
    </div>
</body>
</html>